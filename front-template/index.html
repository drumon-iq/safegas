<!DOCTYPE HTML>
<html>
    <head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width'>
	<title>SafeGas</title>
	<style>
	a {
	text-decoration:none;
	color:white;
	}
	main {
	display:flex;
	align-items:center;
	flex-direction:column
	}
	#valveBut {
	border: solid black;
	width:200px;
	padding: 20px 0 20px 0;
	text-align:center;
	background-color:grey;
	margin:80px;
	}
	#warning {
	color:red;
	visibility:hidden;
	background-color:Bisque;
	padding:10px;
	text-align:center;
	border: solid DarkSalmon;
	}
	</style>
    </head>
    <body>
	<h2 id='warning'>No connection avaible</h2>
	<main>
	<h2>SafeGas</h2>
	    <button id='valveBut' onClick='getData(apiUrl + "toggleValve")' style=''>
		undefined
	    </button>
	<details>
	    <summary>Detalhes e configurações</summary>
	    <ul>
		<li id='gas'>Gas value: Not defined</li>
		<li id='flame'>Flame value: Not defined</li>
	    </ul>
	</details>
	</main>
	<script defer>
	const apiUrl = 'http://127.0.0.1:5000/';
	const warning = document.getElementById('warning');
	const gasItem = document.getElementById('gas');
	const flameItem = document.getElementById('flame');
	const valveB = document.getElementById('valveBut');

	async function getData(url) {
	    try {
		const response = await fetch(url);
		warning.style.visibility = 'hidden';
		return await response.text();
	    } catch (error) {
		warning.style.visibility = 'visible';
		return 'connection failed';
	    }
	}
	setInterval(() => {
	    getData(apiUrl + 'gasValue').then(
		function(res) {
		    gasItem.innerText = 'Gas value: ' + res;
		}
	    );
	    getData(apiUrl + 'flameValue').then(
		function(res) {
		    flameItem.innerText = 'Flame value: ' + res;
		}
	    );
	    getData(apiUrl + 'valveValue').then(
		function(res) {
		    if (res.includes('1')) {
			valveB.innerText = 'Fechar Valvula';
		    }
		    else {
			valveB.innerText = 'Abrir Valvula';
		    }
		});
	}, 1000);
	</script>
    </body>
</html>
